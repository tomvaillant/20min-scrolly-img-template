<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Scroller with figma2html</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
</head>
<body>
    <div id="scrolly-images" class="section scrolly-container">
        <div class="sticky-thing">
            <div class="sticky-inner">
                <div id="infographics-box" class="figma2html">
                    <div id="f2h-frame-300" class="f2h-frame frame artboard" aspect-ratio="0.566" max-width="554">
                        <div class="spacer" style="padding: 0 0 0 0; min-width: 300px; max-width: 554px;"></div>
                        <img id="img-f2h-frame-300" class="f2h-img" src="./assets/300px.png" loading="lazy" draggable="false" decoding="async" width="300.00" height="null" alt="Image 1 - Mobile">
                    </div>
                    <div id="f2h-frame-555" class="f2h-frame frame artboard" aspect-ratio="0.75" min-width="555" max-width="1279">
                        <div class="spacer" style="padding: 0 0 0 0; min-width: 555px; max-width: 1279px;"></div>
                        <img id="img-f2h-frame-555" class="f2h-img" src="./assets/555px.png" loading="lazy" draggable="false" decoding="async" width="555.00" height="null" alt="Image 1 - Tablet">
                    </div>
                    <div id="f2h-frame-1280" class="f2h-frame frame artboard" aspect-ratio="1.414" min-width="1280">
                        <div class="spacer" style="padding: 0 0 0 0; min-width: 1280px; max-width: none;"></div>
                        <img id="img-f2h-frame-1280" class="f2h-img" src="./assets/1280px.png" loading="lazy" draggable="false" decoding="async" width="1280.00" height="null" alt="Image 1 - Desktop">
                    </div>
                </div>
            </div>
        </div>
        <div class="scrolly-overlay">
            <div id="step0" class="step">
                <p>Beim Schlössli Schönegg in Luzern drohen 5'500 Kubikmeter Fels, ohne Vorwarnung jederzeit abzustürzen. Am Rande des Gefährdungsgebiets befinden sich vier Häuser.</p>
            </div>
            <div id="step1" class="step">
                <p>Die Anwohnenden dürfen die bergseitigen Räume wie Schlaf- oder Wohnzimmer bis auf Weiteres nicht mehr nutzen. Ein möglicher Felssturz birgt im Ereignisfall ein hohes Schadenpotenzial.</p>
            </div>
            <div id="step2" class="step">
                <p>Im Sturzraum befinden sich auch die Zufahrtsgleise zum Bahnhof Luzern, was zu einem längeren Unterbruch der Bahnhofszufahrt führen würde. Seit Mitte August wird die Felspartie laufend überwacht.</p>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/scrollama/3.0.4/scrollama.min.js"></script>
<script>
    // Preload images
    const imageNames = ['300px', '300px_1', '300px_2', '555px', '555px_1', '555px_2', '1280px', '1280px_1', '1280px_2'];
    imageNames.forEach(name => {
        const img = new Image();
        img.src = `./assets/${name}.png`;
    });

    function updateImages(mobile, tablet, desktop) {
        console.log(`Updating images: ${mobile}, ${tablet}, ${desktop}`);
        d3.select("#img-f2h-frame-300").attr("src", `./assets/${mobile}.png`);
        d3.select("#img-f2h-frame-555").attr("src", `./assets/${tablet}.png`);
        d3.select("#img-f2h-frame-1280").attr("src", `./assets/${desktop}.png`);
        figma2htmlResize();
    }

    // Scrollama initialization
    const scrollerImg = scrollama();

    scrollerImg
        .setup({
            step: ".step",
            offset: 0.9,
            debug: false
        })
        .onStepEnter(function ({ element, index, direction }) {
            console.log(`Step ${index + 1} entered, direction: ${direction}`);
            switch(index) {
                case 0:
                    updateImages("300px", "555px", "1280px");
                    break;
                case 1:
                    updateImages("300px_1", "555px_1", "1280px_1");
                    break;
                case 2:
                    updateImages("300px_2", "555px_2", "1280px_2");
                    break;
            }
        })
        .onStepExit(function ({ element, index, direction }) {
            console.log(`Step ${index} exited, direction: ${direction}`);
        });

    // figma2html resizer function
    function figma2htmlResize() {
        const infographicsBox = document.getElementById('infographics-box');
        if (!infographicsBox) return;

        const frames = infographicsBox.querySelectorAll('.f2h-frame');
        frames.forEach(frame => {
            frame.style.display = 'none';
        });

        let selectedFrame;
        if (window.innerWidth >= 1280) {
            selectedFrame = infographicsBox.querySelector('#f2h-frame-1280');
        } else if (window.innerWidth >= 555) {
            selectedFrame = infographicsBox.querySelector('#f2h-frame-555');
        } else {
            selectedFrame = infographicsBox.querySelector('#f2h-frame-300');
        }

        if (selectedFrame) {
            selectedFrame.style.display = 'block';
        }
    }

    // Initial resize and event listener
    figma2htmlResize();
    window.addEventListener('resize', figma2htmlResize);

    // Initial image setup
    updateImages("300px", "555px", "1280px");
</script>
</body>
</html>