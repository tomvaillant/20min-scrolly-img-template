<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Scroller with figma2html</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
</head>
<body>
    <div id="scrolly-images" class="section scrolly-container">
        <div class="sticky-thing">
            <div class="sticky-inner">
                <div id="infographics-box" class="figma2html">
                    <div id="f2h-frame-300" class="f2h-frame frame artboard" aspect-ratio="0.566" max-width="554">
                        <div class="spacer" style="padding: 0 0 0 0; min-width: 300px; max-width: 554px;"></div>
                        <object data="./assets/300px.svg" type="image/svg+xml" class="f2h-img" id="img-f2h-frame-300"></object>
                    </div>
                    <div id="f2h-frame-555" class="f2h-frame frame artboard" aspect-ratio="0.75" min-width="555" max-width="1279">
                        <div class="spacer" style="padding: 0 0 0 0; min-width: 555px; max-width: 1279px;"></div>
                        <object data="./assets/555px.svg" type="image/svg+xml" class="f2h-img" id="img-f2h-frame-555"></object>
                    </div>
                    <div id="f2h-frame-1280" class="f2h-frame frame artboard" aspect-ratio="1.414" min-width="1280">
                        <div class="spacer" style="padding: 0 0 0 0; min-width: 1280px; max-width: none;"></div>
                        <object data="./assets/1280px.svg" type="image/svg+xml" class="f2h-img" id="img-f2h-frame-1280"></object>
                    </div>
                </div>
            </div>
        </div>
        <div class="scrolly-overlay">
            <div class='step' data-step='0'>
                <p>High levels of heat and moisture are the basic prerequisites for thunderstorm formation, which is why thunderstorms mainly occur in summer. Each line represents the total lightning strikes for a given year.</p>
            </div>
            <div class='step' data-step='1'>
                <p>Using MeteoSwiss data on rain since 1880, we established an average monthly rain amount to analyze exceptional weather events - August has the highest concentration. These extreme weather events produce <span>large thunderstorms</span>.</p>
            </div>
            <div class='step' data-step='2'>
                <p>Lorem ipsum dolor sit amet consectetur. Morbi laoreet viverra tempor cursus massa sem amet adipiscing. Sodales enim netus in montes consectetur. Ornare massa eu sed ac. Blandit venenatis at pulvinar donec.</p>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/scrollama/3.0.4/scrollama.min.js"></script>
    <script>
        // Preload SVGs
        const imageNames = ['300px', '300px_1', '300px_2', '555px', '555px_1', '555px_2', '1280px', '1280px_1', '1280px_2'];
        imageNames.forEach(name => {
            const xhr = new XMLHttpRequest();
            xhr.open('GET', `./assets/${name}.svg`, true);
            xhr.send();
        });
    
        function updateImages(mobile, tablet, desktop) {
            console.log(`Updating images: ${mobile}, ${tablet}, ${desktop}`);
            d3.select("#f2h-frame-300 object").attr("data", `./assets/${mobile}.svg`);
            d3.select("#f2h-frame-555 object").attr("data", `./assets/${tablet}.svg`);
            d3.select("#f2h-frame-1280 object").attr("data", `./assets/${desktop}.svg`);
            
            // Force reload of SVG content
            ['300', '555', '1280'].forEach(size => {
                const object = document.querySelector(`#f2h-frame-${size} object`);
                if (object) {
                    object.addEventListener('load', function() {
                        const doc = this.contentDocument;
                        if (doc) {
                            doc.location.reload(true);
                        }
                    }, { once: true });
                }
            });
    
            figma2htmlResize();
        }
    
        // Scrollama initialization
        let currentIndex = 0;
        const scrollerImg = scrollama();
        scrollerImg
            .setup({
                step: ".step",
                offset: 0.9,
                debug: true
            })
            .onStepEnter(function ({ element, index, direction }) {
                if (currentIndex == index) return;
                currentIndex = index;
                console.log(`Step ${index + 1} entered, direction: ${direction}`);
                switch(index) {
                    case 0:
                        updateImages("300px", "555px", "1280px");
                        break;
                    case 1:
                        updateImages("300px_1", "555px_1", "1280px_1");
                        break;
                    case 2:
                        updateImages("300px_2", "555px_2", "1280px_2");
                        break;
                }
            })
            .onStepExit(function ({ element, index, direction }) {
                console.log(`Step ${index} exited, direction: ${direction}`);
            });
    
        // figma2html resizer function
        function figma2htmlResize() {
            const infographicsBox = document.getElementById('infographics-box');
            if (!infographicsBox) return;
    
            const frames = infographicsBox.querySelectorAll('.f2h-frame');
            frames.forEach(frame => {
                frame.style.display = 'none';
            });
    
            let selectedFrame;
            if (window.innerWidth >= 1280) {
                selectedFrame = infographicsBox.querySelector('#f2h-frame-1280');
            } else if (window.innerWidth >= 555) {
                selectedFrame = infographicsBox.querySelector('#f2h-frame-555');
            } else {
                selectedFrame = infographicsBox.querySelector('#f2h-frame-300');
            }
    
            if (selectedFrame) {
                selectedFrame.style.display = 'block';
            }
        }
    
        // Initial resize and event listener
        figma2htmlResize();
        window.addEventListener('resize', figma2htmlResize);
    
        // Initial image setup
        updateImages("300px", "555px", "1280px");
    </script>
</body>
</html>